{% extends "layout.html" %}

{% block content %}

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h2>Client N°{{ client.SK_ID_CURR }}</h2>
    <div class="btn-toolbar mb-2 mb-md-0">
        <button type="button" onclick="window.print();" class="btn btn-sm btn-vert-fonce not_impression">
            Export data <span style="padding-left:5px !important"><i class="fa fa-chart-line"></i></span>
        </button>
    </div>
</div>

<div class="card shadow border-0">
    <div class="card-body">
        <div class="row mt-1">
            <div class="col-lg-2 text-center">
                <img src="{{ url_for('static', filename='img/women.png') if client.CODE_GENDER == 'F' else url_for('static', filename='img/men.png') }}" alt="" height="100">

                <div class="mt-3"><h4>{{ (client.DAYS_BIRTH / -365)|int }} years old</h4></div>
                <div><h6>Sexe : {{ "Male" if client.CODE_GENDER == "M" else "Female" if client.CODE_GENDER == "F" else "Non renseigné" }}</h6></div>
            </div>
            <div class="col">
                <div class="row align-items-center justify-content-around">
                    <div class="col-lg-5 fw-bold">Situation familiale:</div>
                    <div class="col-lg-5">{{ client.NAME_FAMILY_STATUS }}</div>
                </div>
                <hr class="my-2">
                <div class="row align-items-center justify-content-around">
                    <div class="col-lg-5 fw-bold">Nombre d'enfant:</div>
                    <div class="col-lg-5">{{ client.CNT_CHILDREN }}</div>
                </div>
                <hr class="my-2">
                <div class="row align-items-center justify-content-around">
                    <div class="col-lg-5 fw-bold">Logement:</div>
                    <div class="col-lg-5">{{ client.NAME_HOUSING_TYPE }}</div>
                </div>
                <hr class="my-2">
                <div class="row align-items-center justify-content-around">
                    <div class="col-lg-5 fw-bold">Emploi:</div>
                    <div class="col-lg-5">{{ client.NAME_INCOME_TYPE }}</div>
                </div>
                <hr class="my-2">
                <div class="row align-items-center justify-content-around">
                    <div class="col-lg-5 fw-bold">Revenu annuel:</div>
                    <div class="col-lg-5">${{ '{:,}'.format(client.AMT_INCOME_TOTAL) }}</div>
                </div>
                <hr class="my-2">
            </div>
        </div>
    </div>
</div>

<div class="row mt-4 align-items-center">
    <div class="col-lg-8">
        <div class="row">
            <div class="col">
                <div class="card shadow border-0">
                    <div class="card-body">
                        <h5 class="text-center">Contract details</h5>
                        <table class="table table-bordered mt-4">
                            <thead>
                            <tr>
                                <th class="bg-light">Contrat type</th>
                                <th class="bg-light">Day</th>
                                <th class="bg-light">Goods price</th>
                                <th class="bg-light">Loan amount</th>
                                <th class="bg-light">Annuity</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>{{ client.NAME_CONTRACT_TYPE }}</td>
                                <td>{{ client_data_enhanced.WEEKDAY_APPR_PROCESS_START }} </td>
                                <td>${{ '{:,}'.format(client.AMT_GOODS_PRICE) }} </td>
                                <td>${{ '{:,}'.format(client.AMT_ANNUITY + client.AMT_CREDIT) }}</td>
                                <td>${{ '{:,}'.format(client.AMT_ANNUITY) }}</td>
                            </tr>
                            </tbody>
                        </table>
                        <br>
                        <div class="row mt-3 mb-3">
                            <div class="col-lg-6">
                                <h6 class="mb-3 text-center"><u>Goods Price VS Loan Amount (without annuity)</u></h6>
                                <canvas class=w-100" id="chart_price"></canvas>
                            </div>
                            <div class="col-lg-6">
                                <h6 class="mb-3 text-center"><u>Part of goodprice covered by the loan</u></h6>
                                <div class="row justify-content-center">
                                    <div class="col-auto">
                                        <div class="circle"><b>{{ client_data_enhanced.CREDIT_PER_ON_GOODPRICE }}%</b></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card shadow border-0">
            <div class="card-body">
                <h5 class="mb-3 text-center">Total loan</h5>
                <canvas class=w-100" id="chart_total_amount"></canvas>
            </div>
        </div>
    </div>
</div>


<div class="card shadow mt-4 border-0">
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-lg-7">
                <h5>Financial situation</h5>
            </div>
            <div class="col-lg-5">
                <h6><u>Analysis of income compared to other clients</u></h6>
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="row justify-content-around mt-5">
                    <div class="col-auto text-center">
                        <h4>${{ '{:,}'.format(client.AMT_INCOME_TOTAL) }}</h4>
                        <br>
                        <h6 class="text-muted">Income</h6>
                    </div>
                    <div class="col-auto text-center">
                        <h4>{{ client.NAME_INCOME_TYPE }}</h4>
                        <br>
                        <h6 class="text-muted">Source</h6>
                    </div>
                    <div class="col-auto text-center">
                        <h4>{{ client.DAYS_EMPLOYED|abs }}</h4>
                        <br>
                        <h6 class="text-muted">Since (in days)</h6>
                    </div>
                </div>
            </div>
            <div class="col-lg-5 offset-lg-1">
                <canvas class=w-100" id="chart_revenu"></canvas>
                <div class="mt-3">Client's income is approximately <b>{{ perc_ecart|abs }}%</b> {{ 'above' if perc_ecart >= 0 else 'below' }} the average income of other clients.</div>
            </div>
        </div>
    </div>
</div>


<div class="row justify-content-around mt-4">
    <div class="col-lg-5">
        <div class="card shadow border-0">
            <div class="card-body text-center">
                <h5>Client own Car</h5>
                <div>{{ 'Yes' if client.FLAG_OWN_CAR == 'Y' else 'No' }}</div>
                <div class="row mt-3 justify-content-center">
                    <div class="col-auto bg-light">
                        <div>{{ client_data_enhanced.CAR_AGE_RANGE|int }}</div>
                        <div>Age RANGE</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-5">
        <div class="card shadow border-0">
            <div class="card-body">
                aa
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block graph %}

    (function () {
        'use strict'


        /*--- Graphique horizontalBar - Comparaison revenu ---*/

        var myChart = new Chart(document.getElementById('chart_revenu'), {
            type: 'horizontalBar',
            data: {
                labels: ['#{{ client.SK_ID_CURR }}', 'Average '],
                datasets: [{
                    label: ['Revenu annuel '],
                    data: [{{ client.AMT_INCOME_TOTAL }}, {{ moy_revenu }}],
                    backgroundColor: ["#00C8AD", "#003D2C"],
                    barThickness: 40
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                },
                legend: { display: false }
            }
        });


        /*--- Graphique doughnut - Total amount ---*/

        var myChart = new Chart(document.getElementById('chart_total_amount'), {
            type: 'doughnut',
            data: {
                labels: ["Annnuity ", "Amount "],
                datasets: [{
                    data: [{{ client.AMT_ANNUITY }}, {{ client.AMT_CREDIT }}],
                    backgroundColor: [
                        '#003D2C',
                        '#00C8AD'
                    ]
                }]
            },
            options: {
                legend: {
                    display: true,
                    position: 'right'
                },
                title: {
                    display: true,
                    position: 'bottom',
                    text: 'Total amount : ${{ '{:,}'.format(client.AMT_ANNUITY + client.AMT_CREDIT) }}'
                }
            }
        });


        /*--- Graphique horizontalBar - Credit info ---*/

        var myChart = new Chart(document.getElementById('chart_price'), {
            type: 'horizontalBar',
            data: {
                labels: ['Bien désiré', 'Prêt demandé'],
                datasets: [{
                    label: ['Montant ($) '],
                    data: [{{ client.AMT_GOODS_PRICE }}, {{ client.AMT_CREDIT }}],
                    backgroundColor: ["#00C8AD", "#003D2C"],
                    barThickness: 40
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                },
                legend: { display: false }
            }
        });

    })()

{% endblock %}